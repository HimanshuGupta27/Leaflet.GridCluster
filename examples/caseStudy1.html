<!DOCTYPE html>
<html>
	<head>
		<title>Grid-Cluster with Leaflet</title>
		<meta charset="utf-8" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="author" content="Andreas Kiefer">

		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

		<link rel="stylesheet" href="../src/GridCluster-colorvalue.css"/>

		<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

		<script src="../src/Leaflet.gridcluster.js"></script>

		<style>
			body {
				font: 1em sans-serif;
			}
			p {
				margin-bottom: 1em;
			}
			#controls {
				position: absolute;
				z-index: 100000;
				bottom: 1em;
				left: 1em;
				background-color: rgba(60,60,60,0.8);
				padding: 1em;
				color: white;
			}

		</style>

	</head>
	<body>
		<div id="description">
			<h2>Bike Stations in Paris</h2>
			<p>
				In this example, the stations of the public bike lending system of Paris are displayed using a grid-based clustering technique.
			</p>

		</div>
		<div id="map" style="width: 100%; height: 600px">

			<div id="controls">
				Gridsize: <span id="currentGridSize"></span>
				<button id="increase">
					Increase
				</button>
				<button id="decrease">
					Decrease
				</button>
				<button id="showCells">
					Toggle Cells
				</button>
				<button id="showCentroids">
					Toggle Centroids
				</button>
				<button id="labelPosition" title="Toggle Label Position: Geometric Center / average Feature Location">
					Label Position
				</button>
				<button id="symbolization">
					Symbol Size / Colour
				</button>
				<button id="showGrid">
					Toggle Grid
				</button>
			</div>
		</div>
		<div>
			&copy; 2015: <a href="mailto:andreas.kiefer@univie.ac.at">Andreas Kiefer</a>
		</div>

		<script>
            var map = L.map('map', { });
            // var tileLayer = L.tileLayer('http://129.206.74.245:8001/tms_r.ashx?x={x}&y={y}&z={z} ',{
            // attribution: 'Map Data: Â© <a href="http://www.openstreetmap.org/">OpenStreetMap</a> contributors'
            // }).addTo(map);
            // L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            // attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            // }).addTo(map);

            // MAPBOX

            var mapboxToken = 'pk.eyJ1IjoiYW5keWtheSIsImEiOiJkYWEwVmNvIn0.u3rKjGASiQ8edIO0qiya-A';
            L.tileLayer('http://api.tiles.mapbox.com/v4/mapbox.run-bike-hike/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiYW5keWtheSIsImEiOiJkYWEwVmNvIn0.u3rKjGASiQ8edIO0qiya-A', {
                 attribution : "<a href='https://www.mapbox.com/about/maps/' target='_blank'>&copy; Mapbox &copy; OpenStreetMap</a> <a class='mapbox-improve-map' href='https://www.mapbox.com/map-feedback/' target='_blank'>Improve this map</a>"
            }).addTo(map);

            var gridCluster = L.gridCluster({
                gridSize : 0.035,
                showGrid : false,
                showCentroids : true,
                symbolizationVariable : 'size',
                weightedCentroids : false,
                minFeaturesToCluster : 1,
                showCells : false,
                maxZoom : 16,
                cellStyle : {
                    color : '#DDD',
                    opacity : 0.2,
                    fillOpacity : 0.43
                },
                colors : ['rgb(252,146,114)', 'rgb(251,106,74)', 'rgb(239,59,44)', 'rgb(203,24,29)', 'rgb(153,0,13)'] //reds
            }).addTo(map);

            map.setView([48.85929, 2.34215], 12);

            var bikestations = $.getJSON("bikes-paris.json", function(data) {

                $.each(data.network.stations, function(i, v) {

                    var station = L.circleMarker([v.latitude, v.longitude], {
                        fillColor : v.free_bikes > 0 ? "green" : "red",
                        stroke : true,
                        color : 'black',
                        fillOpacity : 0.7

                    }).setRadius(7);
                    station.bindPopup("<h3>" + v.name + "</h3>Free Bikes: " + v.free_bikes);
                    // station.addTo(markers);
                    gridCluster.addLayer(station);

                });

                gridCluster._cluster();

            });

            $("#increase").click(function() {
                gridCluster.increaseGridSize();
                $("#currentGridSize").text(gridCluster._currentGridSize);
            });

            $("#decrease").click(function() {
                gridCluster.decreaseGridSize();
                $("#currentGridSize").text(gridCluster._currentGridSize);
            });
            $("#showGrid").click(function() {
                gridCluster.toggleOption("grid");
            });
            $("#showCells").click(function() {
                gridCluster.toggleOption("cells");
            });
            $("#showCentroids").click(function() {
                gridCluster.toggleOption("centroids");
            });
            $("#labelPosition").click(function() {
                gridCluster.toggleOption("labelPos");
            });
            $("#symbolization").click(function() {
                gridCluster.toggleOption("symbolization");
            });

		</script>
	</body>
</html>

